<div class="flex flex-wrap mb-4 mt-4 lg:mt-8">
    <div class="w-1/6 hidden lg:block"></div>
    <div class="lg:w-1/4 flex-grow">
        <div class="p-4">
            <input *ngIf="squad"
                class="text-2xl bg-grey-lighter appearance-none border-2 border-grey-lighter rounded w-full py-2 px-4 text-grey-darker leading-tight focus:outline-none focus:bg-white focus:border-indigo"
                type="text" [(ngModel)]="squad.name" placeholder="Your Squad Name" (input)="pendingChanges = true">
        </div>
        <div class="flex w-full justify-between p-4">
            <div
                class="w-1/4 bg-transparent text-indigo-dark font-semibold py-1 px-2 lg:py-2 lg:px-4 border border-indigo rounded">
                <div class="text-center text-sm">Chemistry</div>
                <div class="text-center text-xl text-black pt-1">{{stats.chemistry | number:'2.0-0'}}%
                </div>
            </div>
            <div
                class="w-1/4 bg-transparent text-indigo-dark font-semibold py-1 px-2 lg:py-2 lg:px-4 border border-indigo rounded">
                <div class="text-center text-sm">Fitness</div>
                <div class="text-center text-xl text-black pt-1">{{stats.fitness | number:'2.0-0'}}%</div>
            </div>
            <div
                class="w-1/4 bg-transparent text-indigo-dark font-semibold py-1 px-2 lg:py-2 lg:px-4 border border-indigo rounded">
                <div class="text-center text-sm">Rating</div>
                <div class="text-center text-xl text-black pt-1">{{stats.rating | number:'2.0-0'}}</div>
            </div>
        </div>

        <div class="isometric-container -mt-20 -mb-20">
            <div class="isometric">
                <div>
                    <div class="flex pb-8 lg:pb-16">
                        <div class="w-1/4 hover:bg-green"></div>
                        <div class="w-1/4 hover:bg-indigo-lighter">
                            <div class="text-center py-2">
                                <pitch-player-card (click)="pickPlayer('LST')" [card]="cards['LST']" size="sm"
                                    mode="squad">
                                </pitch-player-card>
                            </div>
                        </div>
                        <div class="w-1/4 hover:bg-indigo-lighter">
                            <div class="text-center py-2">
                                <pitch-player-card (click)="pickPlayer('RST')" [card]="cards['RST']" size="sm"
                                    mode="squad">
                                </pitch-player-card>
                            </div>
                        </div>
                    </div>
                    <div class="flex pb-8 lg:pb-16">
                        <div class="w-1/4 hover:bg-indigo-lighter">
                            <div class="text-center py-2">
                                <pitch-player-card (click)="pickPlayer('LM')" [card]="cards['LM']" size="sm"
                                    mode="squad">
                                </pitch-player-card>
                            </div>
                        </div>
                        <div class="w-1/4 hover:bg-indigo-lighter">
                            <div class="text-center py-2">
                                <pitch-player-card (click)="pickPlayer('LCM')" [card]="cards['LCM']" size="sm"
                                    mode="squad">
                                </pitch-player-card>
                            </div>
                        </div>
                        <div class="w-1/4 hover:bg-indigo-lighter">
                            <div class="text-center py-2">
                                <pitch-player-card (click)="pickPlayer('RCM')" [card]="cards['RCM']" size="sm"
                                    mode="squad">
                                </pitch-player-card>
                            </div>
                        </div>
                        <div class="w-1/4 hover:bg-indigo-lighter">
                            <div class="text-center py-2">
                                <pitch-player-card (click)="pickPlayer('RM')" [card]="cards['RM']" size="sm"
                                    mode="squad">
                                </pitch-player-card>
                            </div>
                        </div>
                    </div>
                    <div class="flex pb-8 lg:pb-16">
                        <div class="w-1/4 hover:bg-indigo-lighter">
                            <div class="text-center py-2">
                                <pitch-player-card (click)="pickPlayer('LB')" [card]="cards['LB']" size="sm"
                                    mode="squad">
                                </pitch-player-card>
                            </div>
                        </div>
                        <div class="w-1/4 hover:bg-indigo-lighter">
                            <div class="text-center py-2">
                                <pitch-player-card (click)="pickPlayer('LCB')" [card]="cards['LCB']" size="sm"
                                    mode="squad">
                                </pitch-player-card>
                            </div>
                        </div>
                        <div class="w-1/4 hover:bg-indigo-lighter">
                            <div class="text-center py-2">
                                <pitch-player-card (click)="pickPlayer('RCB')" [card]="cards['RCB']" size="sm"
                                    mode="squad">
                                </pitch-player-card>
                            </div>
                        </div>
                        <div class="w-1/4 hover:bg-indigo-lighter">
                            <div class="text-center py-2">
                                <pitch-player-card (click)="pickPlayer('RB')" [card]="cards['RB']" size="sm"
                                    mode="squad">
                                </pitch-player-card>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-center">
                        <div class="w-1/4 hover:bg-indigo-lighter">
                            <div class="text-center py-2">
                                <pitch-player-card (click)="pickPlayer('GK')" [(card)]="cards['GK']" size="sm"
                                    mode="squad">
                                </pitch-player-card>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="lg:w-1/5 lg:ml-12 flex">
        <div class="w-full p-6">
            <button *ngIf="!pendingChanges && squad" routerLink="/squad/active"
                class="w-full h-12 bg-grey text-white font-bold py-2 px-4 rounded">
                <fa-icon [icon]="tickIcon" class="mr-2 text-white ml-2"></fa-icon>
                <span>Last updated {{squad.lastUpdated | timeAgo}}</span>
            </button>
            <button *ngIf="pendingChanges" (click)="save()"
                class="w-full h-12 bg-green text-white font-bold py-2 px-4 rounded">
                <fa-icon [icon]="tickIcon" class="mr-2 text-white ml-2"></fa-icon>
                <span>Save changes</span>
            </button>

            <h4 class="mt-6 mb-6 text-xl">Subs</h4>
            <div *ngIf="squad" class="flex flex-wrap justify-center">
                <pitch-player-card *ngFor="let id of squad.subs; let i = index" (click)="pickSub(i)" [card]="cards[id]"
                    size="sm" mode="squad">
                </pitch-player-card>
            </div>

            <h4 class="mt-6 text-xl">Team Instructions</h4>
            <div class="w-full">
                <h4 class="p-4">Core Style</h4>
                <div class="flex h-8 text-sm">
                    <div class="flex-1 px-2">
                        <button *ngIf="squad" [ngClass]="{'bg-indigo-light': squad.instructions.core == 0}"
                            class="w-full h-full border border-indigo rounded hover:bg-indigo-light"
                            (click)="setTeamInstruction('core', 0)">Default</button>
                    </div>
                    <div class="flex-1 px-2">
                        <button *ngIf="squad" [ngClass]="{'bg-indigo-light': squad.instructions.core == 1}"
                            class="w-full h-full border border-indigo rounded hover:bg-indigo-light"
                            (click)="setTeamInstruction('core', 1)">Attacking</button>
                    </div>
                    <div class="flex-1 px-2">
                        <button *ngIf="squad" [ngClass]="{'bg-indigo-light': squad.instructions.core == 2}"
                            class="w-full h-full border border-indigo rounded hover:bg-indigo-light"
                            (click)="setTeamInstruction('core', 2)">Defensive</button>
                    </div>
                </div>
                <h4 class="p-4">Attacking Style</h4>
                <div class="flex h-8 text-sm">
                    <div class="flex-1 px-2">
                        <button *ngIf="squad" [ngClass]="{'bg-indigo-light': squad.instructions.attacking == 0}"
                            class="w-full h-full border border-indigo rounded hover:bg-indigo-light"
                            (click)="setTeamInstruction('attacking', 0)">Default</button>
                    </div>
                    <div class="flex-1 px-2">
                        <button *ngIf="squad" [ngClass]="{'bg-indigo-light': squad.instructions.attacking == 1}"
                            class="w-full h-full border border-indigo rounded hover:bg-indigo-light"
                            (click)="setTeamInstruction('attacking', 1)">Direct</button>
                    </div>
                    <div class="flex-1 px-2">
                        <button *ngIf="squad" [ngClass]="{'bg-indigo-light': squad.instructions.attacking == 2}"
                            class="w-full h-full border border-indigo rounded hover:bg-indigo-light"
                            (click)="setTeamInstruction('attacking', 2)">Short</button>
                    </div>
                </div>
                <h4 class="p-4">Defensive Style</h4>
                <div class="flex h-8 text-sm">
                    <div class="flex-1 px-2">
                        <button *ngIf="squad" [ngClass]="{'bg-indigo-light': squad.instructions.defensive == 0}"
                            class="w-full h-full border border-indigo rounded hover:bg-indigo-light"
                            (click)="setTeamInstruction('defensive', 0)">Default</button>
                    </div>
                    <div class="flex-1 px-2">
                        <button *ngIf="squad" [ngClass]="{'bg-indigo-light': squad.instructions.defensive == 1}"
                            class="w-full h-full border border-indigo rounded hover:bg-indigo-light"
                            (click)="setTeamInstruction('defensive', 1)">Press</button>
                    </div>
                    <div class="flex-1 px-2">
                        <button *ngIf="squad" [ngClass]="{'bg-indigo-light': squad.instructions.defensive == 2}"
                            class="w-full h-full border border-indigo rounded hover:bg-indigo-light"
                            (click)="setTeamInstruction('defensive', 2)">Contain</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="w-1/6 hidden lg:block"></div>
</div>

<div *ngIf="modal && modal.visible" (click)="modal.visible = false"
    class="inset-0 h-full fixed flex items-center justify-center content-center bg-modal"
    style="background-color: rgba(0, 0, 0, 0.8)">
    <div class="bg-white rounded shadow m-4 max-h-full text-center w-full lg:w-1/5">
        <div class="m-4 p-2 text-lg">
            <p>
                Select a {{modal.position || 'player'}}
                <span class="float-right">
                    <fa-icon [icon]="closeIcon" class="ml-2 text-indigo-lighter"></fa-icon>
                </span>
            </p>
        </div>
        <div class="overflow-y-scroll max-h-screen-1/2" infiniteScroll [infiniteScrollDistance]="2"
            [infiniteScrollThrottle]="50" (scrolled)="onScroll()" [scrollWindow]="false">
            <div *ngFor="let card of modal.cards | async" (click)="modal.callback(card.id)"
                class="flex bg-grey-lighter content-center items-center justify-center p-2 hover:bg-indigo-lighter cursor-pointer">
                <div class="m-2 flex-1">
                    <pitch-player-card [card]="card" size="sm" mode="squad"></pitch-player-card>
                </div>
                <div class="m-2 flex-grow justify-center content-center">{{card.position}}</div>
                <div class="m-2 flex-grow flex-col justify-center content-center">{{card.name}}</div>
                <div class="m-2 flex-grow justify-center content-center">{{card.fitness}}</div>
            </div>
        </div>
        <a href="#" class="block group hover:bg-indigo-lighter p-4 rounded no-underline" (click)="modal.callback(null)">
            <p class="font-bold text-md mb-1 text-black group-hover:text-white">Remove Player</p>
        </a>
    </div>
</div>