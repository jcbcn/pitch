version: 1.0.{build}
image: Visual Studio 2017
install:
- ps: >-
    Install-Product node 8



    $envFile = $env:APPVEYOR_BUILD_FOLDER + '\src\frontend\src\environments\environment.prod.ts'
    
    
    
    Write-Host $envFile
    
    
    
    (Get-Content $envFile).replace('X.X.X.X', $env:APPVEYOR_BUILD_VERSION) | Set-Content $envFile
- cmd: >-
    cd ./src/frontend



    
    npm install
build_script:
- cmd: >-
    cd %appveyor_build_folder%



    
    dotnet publish ./src/api/api.csproj



    
    cd ./src/frontend




    npm link @angular/cli



    
    ng build --prod
artifacts:
- path: src\api\bin\Debug\netcoreapp2.2\publish
  name: pitch-api

- path: src\frontend\dist\pitch-frontend
  name: pitch-frontend
deploy:
- provider: AzureAppServiceZipDeploy
  website: pitch-api
  username: $pitch-api
  password:
    secure: 9UfALmBvkt2ikqf1/Ga3OrLKS3/idP05YhOyWQk+u8JromsJH7D/vXCCZ4AvOGNAGTxvsWUilp1CiYyCXuVKWQ==
  artifact: src\api\bin\Debug\netcoreapp2.2\pitch-api.zip
- provider: AzureAppServiceZipDeploy
  website: pitch-webapp
  username: $pitch-webapp
  password:
    secure: i4Wl8Dua9T+kuAwgbTocGiyJ4qThue347RYNbPBICaGlV4sGYaSrwcclzb5TamHNGhuhabABIbDaHjsc4Mc3VA==
  artifact: pitch-frontend